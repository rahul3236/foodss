'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _esrever = require('esrever');

/**
 * Surrogate pair start and end points.
 *
 * @type {Number}
 */

var SURROGATE_START = 0xD800;
var SURROGATE_END = 0xDFFF;

/**
 * A regex to match space characters.
 *
 * @type {RegExp}
 */

var SPACE = /\s/;

/**
 * A regex to match chameleon characters, that count as word characters as long
 * as they are inside of a word.
 *
 * @type {RegExp}
 */

var CHAMELEON = /['\u2018\u2019]/;

/**
 * A regex that matches punctuation.
 *
 * @type {RegExp}
 */

var PUNCTUATION = /[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/;

/**
 * Is a character `code` in a surrogate character.
 *
 * @param {Number} code
 * @return {Boolean}
 */

function isSurrogate(code) {
  return SURROGATE_START <= code && code <= SURROGATE_END;
}

/**
 * Is a character a word character? Needs the `remaining` characters too.
 *
 * @param {String} char
 * @param {String|Void} remaining
 * @return {Boolean}
 */

function isWord(char, remaining) {
  if (SPACE.test(char)) return false;

  // If it's a chameleon character, recurse to see if the next one is or not.
  if (CHAMELEON.test(char)) {
    var next = remaining.charAt(0);
    var length = getCharLength(next);
    next = remaining.slice(0, length);
    var rest = remaining.slice(length);
    if (isWord(next, rest)) return true;
  }

  if (PUNCTUATION.test(char)) return false;
  return true;
}

/**
 * Get the length of a `character`.
 *
 * @param {String} char
 * @return {Number}
 */

function getCharLength(char) {
  return isSurrogate(char.charCodeAt(0)) ? 2 : 1;
}

/**
 * Get the offset to the end of the first character in `text`.
 *
 * @param {String} text
 * @return {Number}
 */

function getCharOffset(text) {
  var char = text.charAt(0);
  return getCharLength(char);
}

/**
 * Get the offset to the end of the character before an `offset` in `text`.
 *
 * @param {String} text
 * @param {Number} offset
 * @return {Number}
 */

function getCharOffsetBackward(text, offset) {
  text = text.slice(0, offset);
  text = (0, _esrever.reverse)(text);
  return getCharOffset(text);
}

/**
 * Get the offset to the end of the character after an `offset` in `text`.
 *
 * @param {String} text
 * @param {Number} offset
 * @return {Number}
 */

function getCharOffsetForward(text, offset) {
  text = text.slice(offset);
  return getCharOffset(text);
}

/**
 * Get the offset to the end of the first word in `text`.
 *
 * @param {String} text
 * @return {Number}
 */

function getWordOffset(text) {
  var length = 0;
  var i = 0;
  var started = false;
  var char = void 0;

  while (char = text.charAt(i)) {
    var l = getCharLength(char);
    char = text.slice(i, i + l);
    var rest = text.slice(i + l);

    if (isWord(char, rest)) {
      started = true;
      length += l;
    } else if (!started) {
      length += l;
    } else {
      break;
    }

    i += l;
  }

  return length;
}

/**
 * Get the offset to the end of the word before an `offset` in `text`.
 *
 * @param {String} text
 * @param {Number} offset
 * @return {Number}
 */

function getWordOffsetBackward(text, offset) {
  text = text.slice(0, offset);
  text = (0, _esrever.reverse)(text);
  var o = getWordOffset(text);
  return o;
}

/**
 * Get the offset to the end of the word after an `offset` in `text`.
 *
 * @param {String} text
 * @param {Number} offset
 * @return {Number}
 */

function getWordOffsetForward(text, offset) {
  text = text.slice(offset);
  var o = getWordOffset(text);
  return o;
}

/**
 * Export.
 *
 * @type {Object}
 */

exports.default = {
  getCharOffsetForward: getCharOffsetForward,
  getCharOffsetBackward: getCharOffsetBackward,
  getWordOffsetBackward: getWordOffsetBackward,
  getWordOffsetForward: getWordOffsetForward
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9zdHJpbmcuanMiXSwibmFtZXMiOlsiU1VSUk9HQVRFX1NUQVJUIiwiU1VSUk9HQVRFX0VORCIsIlNQQUNFIiwiQ0hBTUVMRU9OIiwiUFVOQ1RVQVRJT04iLCJpc1N1cnJvZ2F0ZSIsImNvZGUiLCJpc1dvcmQiLCJjaGFyIiwicmVtYWluaW5nIiwidGVzdCIsIm5leHQiLCJjaGFyQXQiLCJsZW5ndGgiLCJnZXRDaGFyTGVuZ3RoIiwic2xpY2UiLCJyZXN0IiwiY2hhckNvZGVBdCIsImdldENoYXJPZmZzZXQiLCJ0ZXh0IiwiZ2V0Q2hhck9mZnNldEJhY2t3YXJkIiwib2Zmc2V0IiwiZ2V0Q2hhck9mZnNldEZvcndhcmQiLCJnZXRXb3JkT2Zmc2V0IiwiaSIsInN0YXJ0ZWQiLCJsIiwiZ2V0V29yZE9mZnNldEJhY2t3YXJkIiwibyIsImdldFdvcmRPZmZzZXRGb3J3YXJkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQTs7QUFFQTs7Ozs7O0FBTUEsSUFBTUEsa0JBQWtCLE1BQXhCO0FBQ0EsSUFBTUMsZ0JBQWdCLE1BQXRCOztBQUVBOzs7Ozs7QUFNQSxJQUFNQyxRQUFRLElBQWQ7O0FBRUE7Ozs7Ozs7QUFPQSxJQUFNQyxZQUFZLGlCQUFsQjs7QUFFQTs7Ozs7O0FBTUEsSUFBTUMsY0FBYyxveUNBQXBCOztBQUVBOzs7Ozs7O0FBT0EsU0FBU0MsV0FBVCxDQUFxQkMsSUFBckIsRUFBMkI7QUFDekIsU0FBT04sbUJBQW1CTSxJQUFuQixJQUEyQkEsUUFBUUwsYUFBMUM7QUFDRDs7QUFFRDs7Ozs7Ozs7QUFRQSxTQUFTTSxNQUFULENBQWdCQyxJQUFoQixFQUFzQkMsU0FBdEIsRUFBaUM7QUFDL0IsTUFBSVAsTUFBTVEsSUFBTixDQUFXRixJQUFYLENBQUosRUFBc0IsT0FBTyxLQUFQOztBQUV0QjtBQUNBLE1BQUlMLFVBQVVPLElBQVYsQ0FBZUYsSUFBZixDQUFKLEVBQTBCO0FBQ3hCLFFBQUlHLE9BQU9GLFVBQVVHLE1BQVYsQ0FB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ZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgcmV2ZXJzZSB9IGZyb20gJ2VzcmV2ZXInXG5cbi8qKlxuICogU3Vycm9nYXRlIHBhaXIgc3RhcnQgYW5kIGVuZCBwb2ludHMuXG4gKlxuICogQHR5cGUge051bWJlcn1cbiAqL1xuXG5jb25zdCBTVVJST0dBVEVfU1RBUlQgPSAweEQ4MDBcbmNvbnN0IFNVUlJPR0FURV9FTkQgPSAweERGRkZcblxuLyoqXG4gKiBBIHJlZ2V4IHRvIG1hdGNoIHNwYWNlIGNoYXJhY3RlcnMuXG4gKlxuICogQHR5cGUge1JlZ0V4cH1cbiAqL1xuXG5jb25zdCBTUEFDRSA9IC9cXHMvXG5cbi8qKlxuICogQSByZWdleCB0byBtYXRjaCBjaGFtZWxlb24gY2hhcmFjdGVycywgdGhhdCBjb3VudCBhcyB3b3JkIGNoYXJhY3RlcnMgYXMgbG9uZ1xuICogYXMgdGhleSBhcmUgaW5zaWRlIG9mIGEgd29yZC5cbiAqXG4gKiBAdHlwZSB7UmVnRXhwfVxuICovXG5cbmNvbnN0IENIQU1FTEVPTiA9IC9bJ1xcdTIwMThcXHUyMDE5XS9cblxuLyoqXG4gKiBBIHJlZ2V4IHRoYXQgbWF0Y2hlcyBwdW5jdHVhdGlvbi5cbiAqXG4gKiBAdHlwZSB7UmVnRXhwfVxuICovXG5cbmNvbnN0IFBVTkNUVUFUSU9OID0gL1tcXHUwMDIxLVxcdTAwMjNcXHUwMDI1LVxcdTAwMkFcXHUwMDJDLVxcdTAwMkZcXHUwMDNBXFx1MDAzQlxcdTAwM0ZcXHUwMDQwXFx1MDA1Qi1cXHUwMDVEXFx1MDA1RlxcdTAwN0JcXHUwMDdEXFx1MDBBMVxcdTAwQTdcXHUwMEFCXFx1MDBCNlxcdTAwQjdcXHUwMEJCXFx1MDBCRlxcdTAzN0VcXHUwMzg3XFx1MDU1QS1cXHUwNTVGXFx1MDU4OVxcdTA1OEFcXHUwNUJFXFx1MDVDMFxcdTA1QzNcXHUwNUM2XFx1MDVGM1xcdTA1RjRcXHUwNjA5XFx1MDYwQVxcdTA2MENcXHUwNjBEXFx1MDYxQlxcdTA2MUVcXHUwNjFGXFx1MDY2QS1cXHUwNjZEXFx1MDZENFxcdTA3MDAtXFx1MDcwRFxcdTA3RjctXFx1MDdGOVxcdTA4MzAtXFx1MDgzRVxcdTA4NUVcXHUwOTY0XFx1MDk2NVxcdTA5NzBcXHUwQUYwXFx1MERGNFxcdTBFNEZcXHUwRTVBXFx1MEU1QlxcdTBGMDQtXFx1MEYxMlxcdTBGMTRcXHUwRjNBLVxcdTBGM0RcXHUwRjg1XFx1MEZEMC1cXHUwRkQ0XFx1MEZEOVxcdTBGREFcXHUxMDRBLVxcdTEwNEZcXHUxMEZCXFx1MTM2MC1cXHUxMzY4XFx1MTQwMFxcdTE2NkRcXHUxNjZFXFx1MTY5QlxcdTE2OUNcXHUxNkVCLVxcdTE2RURcXHUxNzM1XFx1MTczNlxcdTE3RDQtXFx1MTdENlxcdTE3RDgtXFx1MTdEQVxcdTE4MDAtXFx1MTgwQVxcdTE5NDRcXHUxOTQ1XFx1MUExRVxcdTFBMUZcXHUxQUEwLVxcdTFBQTZcXHUxQUE4LVxcdTFBQURcXHUxQjVBLVxcdTFCNjBcXHUxQkZDLVxcdTFCRkZcXHUxQzNCLVxcdTFDM0ZcXHUxQzdFXFx1MUM3RlxcdTFDQzAtXFx1MUNDN1xcdTFDRDNcXHUyMDEwLVxcdTIwMjdcXHUyMDMwLVxcdTIwNDNcXHUyMDQ1LVxcdTIwNTFcXHUyMDUzLVxcdTIwNUVcXHUyMDdEXFx1MjA3RVxcdTIwOERcXHUyMDhFXFx1MjMyOVxcdTIzMkFcXHUyNzY4LVxcdTI3NzVcXHUyN0M1XFx1MjdDNlxcdTI3RTYtXFx1MjdFRlxcdTI5ODMtXFx1Mjk5OFxcdTI5RDgtXFx1MjlEQlxcdTI5RkNcXHUyOUZEXFx1MkNGOS1cXHUyQ0ZDXFx1MkNGRVxcdTJDRkZcXHUyRDcwXFx1MkUwMC1cXHUyRTJFXFx1MkUzMC1cXHUyRTNCXFx1MzAwMS1cXHUzMDAzXFx1MzAwOC1cXHUzMDExXFx1MzAxNC1cXHUzMDFGXFx1MzAzMFxcdTMwM0RcXHUzMEEwXFx1MzBGQlxcdUE0RkVcXHVBNEZGXFx1QTYwRC1cXHVBNjBGXFx1QTY3M1xcdUE2N0VcXHVBNkYyLVxcdUE2RjdcXHVBODc0LVxcdUE4NzdcXHVBOENFXFx1QThDRlxcdUE4RjgtXFx1QThGQVxcdUE5MkVcXHVBOTJGXFx1QTk1RlxcdUE5QzEtXFx1QTlDRFxcdUE5REVcXHVBOURGXFx1QUE1Qy1cXHVBQTVGXFx1QUFERVxcdUFBREZcXHVBQUYwXFx1QUFGMVxcdUFCRUJcXHVGRDNFXFx1RkQzRlxcdUZFMTAtXFx1RkUxOVxcdUZFMzAtXFx1RkU1MlxcdUZFNTQtXFx1RkU2MVxcdUZFNjNcXHVGRTY4XFx1RkU2QVxcdUZFNkJcXHVGRjAxLVxcdUZGMDNcXHVGRjA1LVxcdUZGMEFcXHVGRjBDLVxcdUZGMEZcXHVGRjFBXFx1RkYxQlxcdUZGMUZcXHVGRjIwXFx1RkYzQi1cXHVGRjNEXFx1RkYzRlxcdUZGNUJcXHVGRjVEXFx1RkY1Ri1cXHVGRjY1XS9cblxuLyoqXG4gKiBJcyBhIGNoYXJhY3RlciBgY29kZWAgaW4gYSBzdXJyb2dhdGUgY2hhcmFjdGVyLlxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBjb2RlXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5cbmZ1bmN0aW9uIGlzU3Vycm9nYXRlKGNvZGUpIHtcbiAgcmV0dXJuIFNVUlJPR0FURV9TVEFSVCA8PSBjb2RlICYmIGNvZGUgPD0gU1VSUk9HQVRFX0VORFxufVxuXG4vKipcbiAqIElzIGEgY2hhcmFjdGVyIGEgd29yZCBjaGFyYWN0ZXI/IE5lZWRzIHRoZSBgcmVtYWluaW5nYCBjaGFyYWN0ZXJzIHRvby5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gY2hhclxuICogQHBhcmFtIHtTdHJpbmd8Vm9pZH0gcmVtYWluaW5nXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5cbmZ1bmN0aW9uIGlzV29yZChjaGFyLCByZW1haW5pbmcpIHtcbiAgaWYgKFNQQUNFLnRlc3QoY2hhcikpIHJldHVybiBmYWxzZVxuXG4gIC8vIElmIGl0J3MgYSBjaGFtZWxlb24gY2hhcmFjdGVyLCByZWN1cnNlIHRvIHNlZSBpZiB0aGUgbmV4dCBvbmUgaXMgb3Igbm90LlxuICBpZiAoQ0hBTUVMRU9OLnRlc3QoY2hhcikpIHtcbiAgICBsZXQgbmV4dCA9IHJlbWFpbmluZy5jaGFyQXQoMClcbiAgICBjb25zdCBsZW5ndGggPSBnZXRDaGFyTGVuZ3RoKG5leHQpXG4gICAgbmV4dCA9IHJlbWFpbmluZy5zbGljZSgwLCBsZW5ndGgpXG4gICAgY29uc3QgcmVzdCA9IHJlbWFpbmluZy5zbGljZShsZW5ndGgpXG4gICAgaWYgKGlzV29yZChuZXh0LCByZXN0KSkgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGlmIChQVU5DVFVBVElPTi50ZXN0KGNoYXIpKSByZXR1cm4gZmFsc2VcbiAgcmV0dXJuIHRydWVcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGxlbmd0aCBvZiBhIGBjaGFyYWN0ZXJgLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBjaGFyXG4gKiBAcmV0dXJuIHtOdW1iZXJ9XG4gKi9cblxuZnVuY3Rpb24gZ2V0Q2hhckxlbmd0aChjaGFyKSB7XG4gIHJldHVybiBpc1N1cnJvZ2F0ZShjaGFyLmNoYXJDb2RlQXQoMCkpXG4gICAgPyAyXG4gICAgOiAxXG59XG5cbi8qKlxuICogR2V0IHRoZSBvZmZzZXQgdG8gdGhlIGVuZCBvZiB0aGUgZmlyc3QgY2hhcmFjdGVyIGluIGB0ZXh0YC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gdGV4dFxuICogQHJldHVybiB7TnVtYmVyfVxuICovXG5cbmZ1bmN0aW9uIGdldENoYXJPZmZzZXQodGV4dCkge1xuICBjb25zdCBjaGFyID0gdGV4dC5jaGFyQXQoMClcbiAgcmV0dXJuIGdldENoYXJMZW5ndGgoY2hhcilcbn1cblxuLyoqXG4gKiBHZXQgdGhlIG9mZnNldCB0byB0aGUgZW5kIG9mIHRoZSBjaGFyYWN0ZXIgYmVmb3JlIGFuIGBvZmZzZXRgIGluIGB0ZXh0YC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gdGV4dFxuICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldFxuICogQHJldHVybiB7TnVtYmVyfVxuICovXG5cbmZ1bmN0aW9uIGdldENoYXJPZmZzZXRCYWNrd2FyZCh0ZXh0LCBvZmZzZXQpIHtcbiAgdGV4dCA9IHRleHQuc2xpY2UoMCwgb2Zmc2V0KVxuICB0ZXh0ID0gcmV2ZXJzZSh0ZXh0KVxuICByZXR1cm4gZ2V0Q2hhck9mZnNldCh0ZXh0KVxufVxuXG4vKipcbiAqIEdldCB0aGUgb2Zmc2V0IHRvIHRoZSBlbmQgb2YgdGhlIGNoYXJhY3RlciBhZnRlciBhbiBgb2Zmc2V0YCBpbiBgdGV4dGAuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IHRleHRcbiAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXRcbiAqIEByZXR1cm4ge051bWJlcn1cbiAqL1xuXG5mdW5jdGlvbiBnZXRDaGFyT2Zmc2V0Rm9yd2FyZCh0ZXh0LCBvZmZzZXQpIHtcbiAgdGV4dCA9IHRleHQuc2xpY2Uob2Zmc2V0KVxuICByZXR1cm4gZ2V0Q2hhck9mZnNldCh0ZXh0KVxufVxuXG4vKipcbiAqIEdldCB0aGUgb2Zmc2V0IHRvIHRoZSBlbmQgb2YgdGhlIGZpcnN0IHdvcmQgaW4gYHRleHRgLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0XG4gKiBAcmV0dXJuIHtOdW1iZXJ9XG4gKi9cblxuZnVuY3Rpb24gZ2V0V29yZE9mZnNldCh0ZXh0KSB7XG4gIGxldCBsZW5ndGggPSAwXG4gIGxldCBpID0gMFxuICBsZXQgc3RhcnRlZCA9IGZhbHNlXG4gIGxldCBjaGFyXG5cbiAgd2hpbGUgKGNoYXIgPSB0ZXh0LmNoYXJBdChpKSkge1xuICAgIGNvbnN0IGwgPSBnZXRDaGFyTGVuZ3RoKGNoYXIpXG4gICAgY2hhciA9IHRleHQuc2xpY2UoaSwgaSArIGwpXG4gICAgY29uc3QgcmVzdCA9IHRleHQuc2xpY2UoaSArIGwpXG5cbiAgICBpZiAoaXNXb3JkKGNoYXIsIHJlc3QpKSB7XG4gICAgICBzdGFydGVkID0gdHJ1ZVxuICAgICAgbGVuZ3RoICs9IGxcbiAgICB9IGVsc2UgaWYgKCFzdGFydGVkKSB7XG4gICAgICBsZW5ndGggKz0gbFxuICAgIH0gZWxzZSB7XG4gICAgICBicmVha1xuICAgIH1cblxuICAgIGkgKz0gbFxuICB9XG5cbiAgcmV0dXJuIGxlbmd0aFxufVxuXG4vKipcbiAqIEdldCB0aGUgb2Zmc2V0IHRvIHRoZSBlbmQgb2YgdGhlIHdvcmQgYmVmb3JlIGFuIGBvZmZzZXRgIGluIGB0ZXh0YC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gdGV4dFxuICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldFxuICogQHJldHVybiB7TnVtYmVyfVxuICovXG5cbmZ1bmN0aW9uIGdldFdvcmRPZmZzZXRCYWNrd2FyZCh0ZXh0LCBvZmZzZXQpIHtcbiAgdGV4dCA9IHRleHQuc2xpY2UoMCwgb2Zmc2V0KVxuICB0ZXh0ID0gcmV2ZXJzZSh0ZXh0KVxuICBjb25zdCBvID0gZ2V0V29yZE9mZnNldCh0ZXh0KVxuICByZXR1cm4gb1xufVxuXG4vKipcbiAqIEdldCB0aGUgb2Zmc2V0IHRvIHRoZSBlbmQgb2YgdGhlIHdvcmQgYWZ0ZXIgYW4gYG9mZnNldGAgaW4gYHRleHRgLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0XG4gKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0XG4gKiBAcmV0dXJuIHtOdW1iZXJ9XG4gKi9cblxuZnVuY3Rpb24gZ2V0V29yZE9mZnNldEZvcndhcmQodGV4dCwgb2Zmc2V0KSB7XG4gIHRleHQgPSB0ZXh0LnNsaWNlKG9mZnNldClcbiAgY29uc3QgbyA9IGdldFdvcmRPZmZzZXQodGV4dClcbiAgcmV0dXJuIG9cbn1cblxuLyoqXG4gKiBFeHBvcnQuXG4gKlxuICogQHR5cGUge09iamVjdH1cbiAqL1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGdldENoYXJPZmZzZXRGb3J3YXJkLFxuICBnZXRDaGFyT2Zmc2V0QmFja3dhcmQsXG4gIGdldFdvcmRPZmZzZXRCYWNrd2FyZCxcbiAgZ2V0V29yZE9mZnNldEZvcndhcmRcbn1cbiJdfQ==